---
title: "Gemini AI ã‚’ Flutter ã«çµ„ã¿è¾¼ã‚“ã§ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã«å¤‰æ›ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’å®Ÿè³ªç„¡æ–™ã§ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ“±"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter", "Dart", "Gemini", "AI", "åˆå¿ƒè€…"]
published: true
---
# ã“ã‚Œãªã«

- ã¡ã‚‡ã£ã¨ãŠæ‰‹ä¼ã„ã—ã¦ã„ã‚‹ä¼šç¤¾ã§ã€Œç´™ã®ãƒãƒ©ã‚·ã‹ã‚‰ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã—ã¦æ´»ç”¨ã—ãŸã„ã€ã¨ã®è¦æœ›ãŒã‚ã£ãŸ
- ãã®éš›ã«è‰²ã€…ã‚ã£ãŸã‚‚ã®ã®ã€ã€Œã¡ã‚‡ã£ã¨ AI çµ„ã¿è¾¼ã‚“ã§æ¥½ã«å®Ÿè£…ã—ã¦ã¿ãŸã„ãªã€ã¨æ€ã£ãŸã®ã§å®Ÿéš›ã«ã©ã®ã‚ˆã†ãªå€™è£œã‚’æ¤œè¨ã—ã¦ã€ã©ã®ã‚ˆã†ã«å®Ÿè£…ã—ãŸã‹ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ


# ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³æ¡ˆ

## æ–¹é‡æ¤œè¨

ä»Šå›ã®è©±ã§è€ƒãˆãŸã®ã¯å¤§ãã2ã¤ã§ã€flutter ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§æ©Ÿæ¢°å­¦ç¿’çš„ãªã‚‚ã®ãŒä½¿ãˆãªã„ã‹ã©ã†ã‹ã€ã‚‚ã†1ã¤ã¯AIã‚’åˆ©ç”¨ã—ã¦ã®å®Ÿè£…ã§ã—ãŸã€‚
å‡¦ç†æ–¹é‡ã¨ã—ã¦ã¯ Extract text from image (ç”»åƒã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º) => Comprehend text (ãƒ†ã‚­ã‚¹ãƒˆç†è§£) ã‚’è¡Œã†ã“ã¨ã ã£ãŸã®ã§ã€ã“ã‚Œã‚’å®Ÿè£…ã§ããã†ãªæ¡ˆã‚’æ¤œè¨ã—ã¾ã—ãŸã€‚

## æ¡ˆï¼‘ï¼šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆ©ç”¨

æœ€åˆã¯ãªã«ã‹ã—ã‚‰è‰¯ã•ã’ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å®‰ãã§ããªã„ã‹ãªã¨æ€ã£ãŸã®ã§ã™ãŒã€æ¢ã—ãŸã®ã¯ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

https://pub.dev/packages/google_mlkit_text_recognition

ãŸã ã€ã“ã‚Œã¯ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã¾ã§ã§ã‚ã‚Šã€ãƒ†ã‚­ã‚¹ãƒˆç†è§£ã¾ã§ã‚’è¡Œã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ¢ã—ã¦ã‚‚ã‚ã¾ã‚Šè‰¯ã•ã’ãªã‚‚ã®ãŒãªãã€flutterãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ¡ˆã®åˆ©ç”¨ã¯å®Ÿç¾ã§ãã¾ã›ã‚“ã§ã—ãŸ

## æ¡ˆï¼’ï¼šAIåˆ©ç”¨

æ¡ˆï¼‘ã®èª¿æŸ»ã«ã‚ˆã£ã¦ã€ã‚„ã¯ã‚Šæ•°å°‘ãªã„å®Ÿè£…é‡ã§ã‚„ã‚ŠãŸã„ã“ã¨ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯AIåˆ©ç”¨ãŒæ—©ãã†ã§ã—ãŸã€‚
ãã“ã§æ¤œè¨ã—ãŸã®ã¯ä¾¡æ ¼é¢ã§ã€å°ã•ã„ã‚¢ãƒ—ãƒªãªã®ã§ã¨ã«ã‹ãå®‰ãã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€èª¿ã¹ãŸã®ã¯ä»¥ä¸‹ã®é€šã‚Šï¼š

### Claude

ä»¥ä¸‹ã®é€šã‚Šæœ‰æ–™ãƒ—ãƒ©ãƒ³ã®ã¿ã§ã€å¤§é‡ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãŒå¾—æ„ãªClaudeã¯é­…åŠ›çš„ã§ã¯ã‚ã£ãŸã‚‚ã®ã®ã€ã¡ã‚‡ã£ã¨é›£ã—ãã†ã ãªã¨æ€ã„ã¾ã—ãŸã€‚

- Input: $1 / MTok
- Output: $5 / MTok
- Ref: https://www.claude.com/pricing

![alt text](/images/2025-10-19_claude_api_pricing.png)

### Gemini

Free, Paid, Enterprise ã¨ç„¡æ–™ãƒ—ãƒ©ãƒ³ãŒç”¨æ„ã•ã‚Œã¦ã„ãŸã®ã§ã€å³æ±ºã§ Gemini ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã€‚

https://ai.google.dev/gemini-api/docs/pricing

![alt text](/images/2025-10-19_gemini_api_pricing.png)

### ChatGPT

ä¸€å¿œ ChatGPT ã‚‚èª¿ã¹ã¾ã—ãŸãŒã€æœ‰æ–™ãƒ—ãƒ©ãƒ³ã®ã¿ã§ Claude åŒæ§˜ã«é€Ÿæ”»ã§å€™è£œã‹ã‚‰å¤–ã—ã¾ã—ãŸ

- Input: $0.050 / 1M tokens
- $0.400 / 1M tokens
- Ref: https://openai.com/api/pricing/

![alt text](/images/2025-10-19_chatgpt_api_pricing.png)


# Gemini ã‚’ Flutter ã«çµ„ã¿è¾¼ã‚“ã§ç”»åƒãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã«å¤‰æ›ã™ã‚‹ã¾ã§ã®å®Ÿè£…

## Step 1: Gemini API ã‚­ãƒ¼ã‚’ç™ºè¡Œã—ã¦ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜

ä»¥ä¸‹ã® URL ã‹ã‚‰ API ã‚­ãƒ¼ã‚’ç™ºè¡Œã—ã¾ã™ã€‚
ãã®å¾Œã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `./.env` ã®ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ç™ºè¡Œã—ãŸAPIã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚

https://aistudio.google.com/app/apikey

![alt text](/images/2025-10-19_gemini_step_01.png)

## Step 2: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æº–å‚™

`lib/prompts/gemini/flyer_extraction_prompt.dart` ã«ä½•ã‚’ã—ã¦æ¬²ã—ã„ã®ã‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æº–å‚™ã—ã¾ã™ã€‚
ã¡ãªã¿ã«è‡ªåˆ†ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æº–å‚™ã—ã€ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå½¢å¼ã‚‚æŒ‡å®šã—ã¾ã—ãŸã€‚

```dart
/// Prompts for Gemini AI to extract information from flyer images
class FlyerExtractionPrompt {
  /// Get the prompt for extracting flyer information
  static String get extractFlyerInfo => '''
This image is a flyer for an event or campaign. Please extract the following information and return it in JSON format:

1. title: The title of the event or campaign (the most prominent text. Return empty string if not found. **Must be in Japanese**)
2. description: Event description or details (2-3 sentences. Return empty string if not found. **Must be in Japanese**)
3. start_date: Start date (YYYY/MM/DD format. Return empty string if not found)
4. end_date: End date (YYYY/MM/DD format. Return empty string if not found)
5. guest_capacity: Capacity or attendance limit (numbers only. Return empty string if not found or if 0)

Important notes:
- The title and description fields must be returned in Japanese (æ—¥æœ¬èª)
- If the corresponding information does not exist in the image for each field, you must return an empty string ("")
- Dates must be returned in YYYY/MM/DD format (e.g., 2025/3/1)
- Guest capacity should return numbers only. Do not include units (e.g., "people", "persons")
- Do not include uncertain information or guesses, only extract information that is clearly stated

JSON format example (when information is available):
{
  "title": "æ˜¥ã®ç‰¹åˆ¥ã‚»ãƒ¼ãƒ«",
  "description": "æœŸé–“é™å®šã®ç‰¹åˆ¥ä¾¡æ ¼ã§ã”æä¾›ã—ã¾ã™",
  "start_date": "2025/3/1",
  "end_date": "2025/3/31",
  "guest_capacity": "50"
}

JSON format example (when some information is missing):
{
  "title": "å¤ç¥­ã‚Š",
  "description": "åœ°åŸŸã®å¤ç¥­ã‚Šã‚¤ãƒ™ãƒ³ãƒˆ",
  "start_date": "2025/7/15",
  "end_date": "",
  "guest_capacity": ""
}

Do not return any text other than JSON.
''';
}
```

## Step 3: flutter ã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Flutter ã§ Gemini ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ `flutter_gemini` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€å¾Œã»ã© `.env` ã‹ã‚‰ã®å€¤èª­ã¿è¾¼ã¿ãŒå¿…è¦ãªã®ã§ã€ä½µã›ã¦ `flutter_dotenv` ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

```dart
flutter pub add flutter_gemini
flutter pub add flutter_dotenv
```

## Step 4: GeminiåˆæœŸåŒ–

ç›´æ¥APIã‚­ãƒ¼ã‚’ã‚³ãƒ¼ãƒ‰ã«æ›¸ãã®ã¯ä¸€èˆ¬çš„ã«ã¯æ¨å¥¨ã•ã‚Œãªã„ã®ã§ã€ `main.dart` ã« `flutter_gemini` ã¨ `flutter_dotenv` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¤ã¤ã€ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿ã‚’è¡Œãªã£ã¦å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§è¨­å®šã—ã¦ã„ã‚‹ Gemini API ã‚­ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚

```dart
..
import 'package:flutter_dotenv/flutter_dotenv.dart';
import 'package:flutter_gemini/flutter_gemini.dart';

..

Future<void> main() async {
  // Load environment variables
  await dotenv.load(fileName: '.env');

  // Initialize Gemini
  final geminiApiKey = dotenv.env['GEMINI_API_KEY'];
  if (geminiApiKey != null && geminiApiKey.isNotEmpty) {
    Gemini.init(apiKey: geminiApiKey);
  }

  runApp(const MyApp());
}
```

## Step 5: Flutterã‚³ãƒ¼ãƒ‰å†…ã§Geminiã‚’å‘¼ã³å‡ºã—ã¦ Textract ==> Comprehend ã‚’å®Ÿè¡Œã™ã‚‹

ãƒã‚¤ãƒ³ãƒˆã®ã¿ã‚’æŠœç²‹ã™ã‚‹ã¨ä»¥ä¸‹ã®3ã¤ã®å‡¦ç†ã‚’è¡Œã†ã“ã¨ã§ç”»åƒã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

1. ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚¤ãƒˆã«å¤‰æ›
1. Geminiã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
1. Geminiã‚’ä½¿ã£ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æŠ•ã’ã¦ç”»åƒã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—

```dart
// Read image as bytes
final bytes = await imageFile.readAsBytes();

// Get Gemini instance
final gemini = Gemini.instance;

// Request Gemini API with the flyer extraction prompt
final response = await gemini.textAndImage(
  text: FlyerExtractionPrompt.extractFlyerInfo,
  images: [bytes],
);
```

å…¨ã¦ã®å‡¦ç†ã‚’æ›¸ãã¨ä»¥ä¸‹ã®é€šã‚Šã€‚

```dart
import 'dart:convert';
import 'package:flutter_gemini/flutter_gemini.dart';
import 'package:flutter_sample/prompts/gemini/flyer_extraction_prompt.dart';

...

  /// Take a photo by camera
  Future<void> _pickImageFromCamera() async {
    try {
      final XFile? image = await _picker.pickImage(
        source: ImageSource.camera,
        imageQuality: 85,
      );

      if (image != null) {
        final imageFile = File(image.path);
        setState(() {
          _imageFile = imageFile;
        });
        if (mounted) {
          Navigator.pop(context);
        }

        // Textract with Gemini AI
        await _extractTextWithGemini(imageFile);
      }
    } catch (e) {
      debugPrint('Error taking photo from camera: $e');
    }
  }

  /// Textract from image by using Gemini AI
  Future<void> _extractTextWithGemini(File imageFile) async {
    setState(() {
      _isProcessing = true;
    });

    try {
      // Clear all form fields except store dropdown before API call
      _titleController.clear();
      _descriptionController.clear();
      _startDateController.clear();
      _endDateController.clear();
      _guestCapacityController.clear();

      // Read image as bytes
      final bytes = await imageFile.readAsBytes();

      // Get Gemini instance
      final gemini = Gemini.instance;

      // Request Gemini API with the flyer extraction prompt
      final response = await gemini.textAndImage(
        text: FlyerExtractionPrompt.extractFlyerInfo,
        images: [bytes],
      );

      // Analyze response
      final text = response?.output;
      if (text != null && text.isNotEmpty) {
        debugPrint('Gemini response: $text');

        // Get JSON (Remove markdown code block)
        String jsonText = text.trim();
        if (jsonText.startsWith('```json')) {
          jsonText = jsonText.substring(7);
        }
        if (jsonText.startsWith('```')) {
          jsonText = jsonText.substring(3);
        }
        if (jsonText.endsWith('```')) {
          jsonText = jsonText.substring(0, jsonText.length - 3);
        }
        jsonText = jsonText.trim();

        // Parse JSON
        final data = jsonDecode(jsonText) as Map<String, dynamic>;
        _fillFormFromGeminiResponse(data);
      }
    } catch (e) {
      debugPrint('Error extracting text with Gemini: $e');
    } finally {
      setState(() {
        _isProcessing = false;
      });
    }
  }

  /// Input responses retrieved from Gemini into forms
  void _fillFormFromGeminiResponse(Map<String, dynamic> data) {
    setState(() {
      // Title
      if (data['title'] != null && data['title'].toString().trim().isNotEmpty) {
        _titleController.text = data['title'].toString().trim();
      }

      // Description
      if (data['description'] != null &&
          data['description'].toString().trim().isNotEmpty) {
        _descriptionController.text = data['description'].toString().trim();
      }

      // Start date and End date
      // If only one date is provided, set both fields to the same value
      final startDateStr = data['start_date']?.toString().trim() ?? '';
      final endDateStr = data['end_date']?.toString().trim() ?? '';

      final hasStartDate = startDateStr.isNotEmpty && _isValidDate(startDateStr);
      final hasEndDate = endDateStr.isNotEmpty && _isValidDate(endDateStr);

      if (hasStartDate && hasEndDate) {
        // Both dates are available
        _startDateController.text = startDateStr;
        _endDateController.text = endDateStr;
      } else if (hasStartDate && !hasEndDate) {
        // Only start date is available, set both fields to the same value
        _startDateController.text = startDateStr;
        _endDateController.text = startDateStr;
      } else if (!hasStartDate && hasEndDate) {
        // Only end date is available, set both fields to the same value
        _startDateController.text = endDateStr;
        _endDateController.text = endDateStr;
      }
      // If no dates are available, leave both fields blank

      // Guest capacity
      if (data['guest_capacity'] != null &&
          data['guest_capacity'].toString().trim().isNotEmpty) {
        final capacity = data['guest_capacity'].toString().trim();
        // Retrieve only numeric
        final numericCapacity = capacity.replaceAll(RegExp(r'[^0-9]'), '');
        // Set in case that there is not any 0 values
        if (numericCapacity.isNotEmpty &&
            int.tryParse(numericCapacity) != null &&
            int.parse(numericCapacity) > 0) {
          _guestCapacityController.text = numericCapacity;
        }
      }
    });
  }

  /// Date validation
  bool _isValidDate(String dateStr) {
    if (dateStr.isEmpty) return false;

    final datePattern = RegExp(r'^\d{4}[/-]\d{1,2}[/-]\d{1,2}$');
    if (!datePattern.hasMatch(dateStr)) return false;

    try {
      final parts = dateStr.split(RegExp(r'[/-]'));
      final year = int.parse(parts[0]);
      final month = int.parse(parts[1]);
      final day = int.parse(parts[2]);

      if (year < 1900 || year > 2100) return false;
      if (month < 1 || month > 12) return false;
      if (day < 1 || day > 31) return false;

      return true;
    } catch (e) {
      return false;
    }
  }
```


# ãŠã‚ã‚Šã«

- å®Ÿã®ã¨ã“ã‚ã‚³ãƒ¼ãƒ‰ã®8å‰²ãã‚‰ã„ã¯ Claude ã«æ›¸ã„ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸ
- Claude ã‚’ä½•ã‚‚æŒ‡ç¤ºã›ãšãƒ†ã‚­ãƒˆãƒ¼ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚‚ã‚‰ã†ã¨1ã¤ã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Œçµã—ã‚ˆã†ã¨ã—ã¡ã‚ƒã†ã®ã§ãã®è¾ºã‚ŠæŒ‡ç¤ºãŒå¿…è¦ã ã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚‚å¿…è¦ãªã®ã§ã™ãŒã€ã‚„ã¯ã‚Šè‡ªåˆ†ã§æ›¸ãã‚ˆã‚Šåœ§å€’çš„ã«é€Ÿã„ã§ã™ã­
- ãã‚“ãª AI ä½¿ã£ã¦ AI çµ„ã¿è¾¼ã¿ã—ãŸã®ãŒæ¥½ã—ãã¦[ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼ã«ãŠæ°—æŒã¡ãƒã‚¹ãƒˆã—ã¡ã‚ƒã„ã¾ã—ãŸ](https://x.com/su3_hokkaido/status/1979165805641150827)


# å‚è€ƒè¨˜äº‹

- https://ai.google.dev/gemini-api/docs
